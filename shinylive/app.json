[{"name":"app.R","content":"library(shiny)\r\nlibrary(genpwr)\r\n\r\nui <- fluidPage(\r\n  titlePanel(\"Calculadora GWAS: Tama침o de Muestra\"),\r\n  \r\n  sidebarLayout(\r\n    sidebarPanel(\r\n      h4(\"Par치metros del Estudio\"),\r\n      selectInput(\"model\", \"Modelo del Test (Hip칩tesis):\",\r\n                  choices = c(\"Aditivo\" = \"Additive\", \r\n                              \"Dominante\" = \"Dominant\", \r\n                              \"Recesivo\" = \"Recessive\")),\r\n      hr(),\r\n      sliderInput(\"maf\", \"Frecuencia Alelo Menor (MAF):\", 0.01, 0.5, 0.1, 0.01),\r\n      sliderInput(\"or\", \"Odds Ratio (Efecto):\", 1.05, 2.0, 1.25, 0.05),\r\n      numericInput(\"alpha\", \"Significancia (Alpha):\", value = 5e-8),\r\n      sliderInput(\"power\", \"Potencia deseada:\", 0.5, 0.95, 0.8, 0.05)\r\n    ),\r\n    \r\n    mainPanel(\r\n      wellPanel(\r\n        h3(\"Individuos Necesarios (Total)\"),\r\n        helpText(\"Calculado para casos = controles (k=1)\"),\r\n        hr(),\r\n        htmlOutput(\"sampleSizeText\")\r\n      )\r\n    )\r\n  )\r\n)\r\n\r\nserver <- function(input, output) {\r\n  \r\n  output$sampleSizeText <- renderUI({\r\n    \r\n    # Validamos que todos los inputs existan\r\n    req(input$model, input$maf, input$or, input$alpha, input$power)\r\n    \r\n    # Hacemos el c치lculo de muestra (ss.calc)\r\n    res <- tryCatch({\r\n      genpwr::ss.calc(\r\n        OR = as.numeric(input$or),\r\n        k = 1,\r\n        MAF = as.numeric(input$maf), \r\n        Alpha = as.numeric(input$alpha),\r\n        power = as.numeric(input$power),\r\n        Test.Model = input$model\r\n      )\r\n    }, error = function(e) return(NULL))\r\n    \r\n    if(is.null(res)) return(HTML(\"<b style='color:red'>Error en el c치lculo. Revisa los par치metros.<\/b>\"))\r\n    \r\n    # Funci칩n simple para extraer el n칰mero\r\n    get_n <- function(modelo_real) {\r\n      # Buscamos la fila correcta ignorando may칰sculas/min칰sculas\r\n      fila <- which(tolower(res$True.Model) == tolower(modelo_real))\r\n      \r\n      if(length(fila) == 0) return(\"N/A\")\r\n      \r\n      valor <- res$N_total[fila]\r\n      if(is.na(valor)) return(\"Infinito (Efecto muy peque침o)\")\r\n      \r\n      # Formateamos el n칰mero con puntos de miles (ej: 10.000)\r\n      return(format(round(valor), big.mark = \".\", decimal.mark = \",\"))\r\n    }\r\n    \r\n    # Extraemos los 3 valores clave\r\n    n_add <- get_n(\"Additive\")\r\n    n_dom <- get_n(\"Dominant\")\r\n    n_rec <- get_n(\"Recessive\")\r\n    \r\n    # Mostramos el resultado limpio\r\n    HTML(paste0(\r\n      \"<div style='font-size: 16px; line-height: 1.8;'>\",\r\n      \"<ul style='list-style-type: none; padding-left: 0;'>\",\r\n      \"<li>游릭 Si la realidad biol칩gica es <b>Aditiva<\/b>: <h3>\", n_add, \" individuos<\/h3><\/li>\",\r\n      \"<li>游댯 Si la realidad biol칩gica es <b>Dominante<\/b>: <h3>\", n_dom, \" individuos<\/h3><\/li>\",\r\n      \"<li>游댮 Si la realidad biol칩gica es <b>Recesiva<\/b>: <h3>\", n_rec, \" individuos<\/h3><\/li>\",\r\n      \"<\/ul>\",\r\n      \"<\/div>\"\r\n    ))\r\n  })\r\n}\r\n\r\nshinyApp(ui, server)","type":"text"}]
